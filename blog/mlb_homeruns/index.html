<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.47.1" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Leave the Munging to the Machines - MLB Edition </title>

  
  <meta name="description" content="Kasey &amp; Rico created a qri dataset from the MLB Home Run rankings on baseballreference.com"> 
  
  
  
  
  

  

  <meta name="author" content="map[display_name:ramfox, Rico given_name:Kasey, Rico family_name:Huizinga, Gardaphe]">


  <meta property="og:title" content="Leave the Munging to the Machines - MLB Edition" />
<meta property="og:description" content="Kasey &amp; Rico created a qri dataset from the MLB Home Run rankings on baseballreference.com" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://qri.io/blog/mlb_homeruns/" /><meta property="article:published_time" content="2019-04-17T15:00:00-04:00"/>
<meta property="article:modified_time" content="2019-04-17T15:00:00-04:00"/>
  




  
  
  
  
  

  <link rel="canonical" href="https://qri.io/blog/mlb_homeruns/">  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/regular.min.css" rel="stylesheet">

  <link href="../../favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="../../css/font.css" rel="stylesheet" type="text/css">
  <link href="../../css/qri.css" rel="stylesheet" type="text/css">
  <link href="../../css/docs.css" rel="stylesheet" type="text/css">


  <script src="../../js/jquery-2.1.4.min.js" type="text/javascript"></script>
  <link rel="stylesheet" href="../../css/highlight.default.min.css">
  <link rel="stylesheet" href="../../css/highlight.theme.tomorrow.css">
  <script src="../../js/highlight.pack.js"></script>
  <script>
    window.onload = function(e) {
      let elements = document.querySelectorAll('.highlight pre')
      Array.from(elements).forEach((block, i) => {
        hljs.highlightBlock(block)
      })
    }
  </script>

  <script type="text/javascript" src="../../js/tocbot.min.js"></script>

  
    <script type="text/javascript">
     !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
      analytics.load("b4iAxJT8ISitRFQ6qZGS9w7RTnaOpvju");
      analytics.page()
    }}();
    </script>
  
</head>


<body class="page-kube blog " >
  <header> <div class="show_sm light">
  <div id="nav_toggle_box">
    <div id="nav_toggle_brand">
      <a href="../../">qri</a>
    </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
  </div>
</div>

<div id="main_nav" class="hide_sm light">
  <div class="wrap">
    <div class="logotype">
      <a href="../../" title="home">qri</a>
    </div>
    <nav class="menu" >
       
       
    <a href="../../about" >About</a>
    
    <a href="../../blog/" >Blog</a>
    
    <a href="../../docs/" >Docs</a>
    
    <a href="../../download/" >Download</a>
    
    </nav>
  </div>
</div>
 </header>
  <main>
<div id="blog" class="page">
  <header>
    <div class="wrap">
      <h1 class="title">Leave the Munging to the Machines - MLB Edition</h1>
      <p class="info"><span class="date">Apr 17, 2019</span> <span class="tag">Baseball stats</span><span class="tag">transform script</span><span class="tag">web scraping</span></p>
      <p class="info"><i>written by ramfox, Rico</i></p>
    </div>
  </header>
  <section class="content">
    <div class="wrap">
        

<p><strong>Summary:</strong></p>

<ul>
<li><em>Create a clean, reusable qri dataset by scraping data stored in an ugly table.</em></li>
<li><em>Rerun a script to retrieve updated data (however frequently you like)</em></li>
<li><em>See and have the code I used to create my dataset, and feel free to fork that code and adapt to your liking.</em></li>
</ul>

<hr />

<p>Look up the latest rankings of <a href="https://www.baseball-reference.com/leaders/HR_career.shtml">MLB home run leaders on baseballreference.com</a> (the authority on MLB stats), and you’ll get a table like this:</p>

<div class="clear"></div>

<div class="diagram large">
  <img src="../../diagrams/br_table.png" />
</div>
 

<p>If all you care about is the player’s rank and home run count, each of which has a dedicated column, this table works just fine. Less helpful, the table provides interesting information in a code you need to crack before adapting the data for your own purpose.</p>

<p>For example, in the baseballreference.com table:</p>

<ul>
<li>A player’s Hall of Fame status is signified by a “+ “ appearing next to their name. If you see a &ldquo;+&rdquo;, they&rsquo;re a Hall of Famer, if you don&rsquo;t, they&rsquo;re not.</li>
<li>The number of MLB seasons played is in parentheses next to their name.</li>
<li>However! If the player is still active, their name is in bold, and the first number in their parenthesis is their number of seasons, and the second number is their current age.</li>
<li>And, in every 50th row, the table maker introduces a new header row, which you&rsquo;ll have to cut out 20 times in a list of 1,000 names (as this is).</li>
</ul>

<hr />

<h2 id="div-class-tenor-gif-embed-data-postid-4679471-data-share-method-host-data-width-100-data-aspect-ratio-1-7913669064748199-a-href-https-tenor-com-view-eww-jimmy-fallon-ew-gif-4679471-eww-jimmy-fallon-gif-a-from-a-href-https-tenor-com-search-eww-gifs-eww-gifs-a-div-script-type-text-javascript-async-src-https-tenor-com-embed-js-script"><div class="tenor-gif-embed" data-postid="4679471" data-share-method="host" data-width="100%" data-aspect-ratio="1.7913669064748199"><a href="https://tenor.com/view/eww-jimmy-fallon-ew-gif-4679471">Eww Jimmy Fallon GIF</a> from <a href="https://tenor.com/search/eww-gifs">Eww GIFs</a></div><script type="text/javascript" async src="https://tenor.com/embed.js"></script></h2>

<hr />

<p><strong>Ew.</strong></p>

<p>Anyone who regularly plays with data is shaking their head and wondering, “Why not have a column that says Hall of Fame &ldquo;Yes/No&rdquo;, another column that says, Active &ldquo;Yes/No” etc.? Before a baseball stats fan can work with this table, she will have to copy it into a spreadsheet and manually clean it to her liking. No one gets to see her work, and everyone has to &lsquo;redo&rsquo; that same cleaning on their own. It’s estimated that this kind of work comprises up to <a href="https://www.forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/#62fb35096f63">80% of a data scientist’s job</a>. EW!</p>

<p><strong>Wouldn’t it be nice…</strong></p>

<p><strong>A.</strong>  Wouldn’t it be nice if we could all benefit from the first person’s work to clean up that dataset?</p>

<p><strong>B.</strong>  Wouldn’t it be nice to trust their cleaning work by easily auditing / tracking their steps?</p>

<p><strong>C.</strong>  Wouldn’t it be nice to know that if I wanted to take a different approach, I could take their work, copy it, and adapt it as I saw fit?</p>

<p><strong>D.</strong>  And wouldn’t it be nice to have the script tied to the data, so I could simply re-run it and retrieve updated rankings? <em>[Coming soon: Ability to set a script to run by itself, retrieve data at a specific frequency, and update my data itself &ndash; giving me a new version every day, week, month, or season]</em></p>

<p>I’ve used qri to do each of those. Here’s how:</p>

<p><strong>Transform Scripts: from web scraping to a qri dataset</strong></p>

<p>We use a python-like syntax called <a href="https://qri.io/docs/reference/starlark_syntax/">Starlark</a> to draft a Transform script to pull in data from the wild, and tweak the way it’s represented. For example, I used my script to create new columns for the player’s hall of fame status and active/inactive status. That accomplishes A &amp; B from the list above.</p>

<p>Here’s what that code looks like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">parseRow</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">latest_rank</span><span class="p">):</span>
  <span class="c1"># row has 5 sections</span>
  <span class="n">tds</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">children_filtered</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tds</span><span class="o">.</span><span class="nb">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># rank, player (yrs, age), player profile, home runs, bats, hr log</span>
    <span class="c1"># 1st td -&gt; rank</span>
    <span class="c1"># 2nd td -&gt; player (yrs, age), &lt;a&gt; tag contains player profile link</span>
    <span class="c1"># 3rd td -&gt; home runs</span>
    <span class="c1"># 4th td -&gt; bats</span>
    <span class="c1"># 5th td -&gt; &lt;a&gt; tag contains hr log link</span>
    <span class="c1">#</span>
    <span class="n">rank_string</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">latest_rank</span>
    <span class="n">player</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">hof</span> <span class="o">=</span> <span class="s2">&#34;N&#34;</span>
    <span class="n">mlb_seasons</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">active</span> <span class="o">=</span> <span class="s2">&#34;N&#34;</span>
    <span class="n">age_if_active</span> <span class="o">=</span> <span class="s2">&#34;-&#34;</span>
    <span class="n">player_profile_link</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">home_runs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bats</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">hr_log_link</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c1">#</span>
    <span class="c1"># rank</span>
    <span class="c1">#</span>
    <span class="n">rank_string</span> <span class="o">=</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rank_string</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
      <span class="n">rank</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rank_string</span><span class="p">)</span>
      <span class="n">latest_rank</span> <span class="o">=</span> <span class="n">rank</span>
    <span class="c1">#</span>
    <span class="c1"># player name, hall of fame status, mlb seasons, active, age if active</span>
    <span class="c1"># Dave Winchester+ (23, 59)</span>
    <span class="c1">#</span>
    <span class="n">player</span> <span class="o">=</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="n">player_split</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;(&#34;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># player_split = [ &#34;Dave Winchester+ &#34;, &#34;23, 59)&#34; ]</span>
    <span class="c1">#</span>
    <span class="n">name_hof</span> <span class="o">=</span> <span class="n">player_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&#34;+&#34;</span> <span class="ow">in</span> <span class="n">name_hof</span><span class="p">:</span>
      <span class="n">hof</span> <span class="o">=</span> <span class="s2">&#34;Y&#34;</span>
      <span class="n">name_hof</span> <span class="o">=</span> <span class="n">name_hof</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;+&#34;</span><span class="p">)</span>
    <span class="n">player_name</span> <span class="o">=</span> <span class="n">name_hof</span>
    <span class="c1">#</span>
    <span class="c1"># seasons_age_split = [ &#34;23&#34;, &#34; 59&#34; ]</span>
    <span class="c1"># or</span>
    <span class="c1"># seasons_age_split = [ &#34;23&#34; ]</span>
    <span class="c1">#</span>
    <span class="n">seasons_age_split</span> <span class="o">=</span> <span class="n">player_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;)&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">)</span>
    <span class="n">mlb_seasons</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seasons_age_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seasons_age_split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">active</span> <span class="o">=</span> <span class="s2">&#34;Y&#34;</span>
      <span class="n">age_if_active</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seasons_age_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="c1">#</span>
    <span class="n">player_profile_link</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">home_runs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></code></pre></div>
<p>When you run the script and then click over to ‘body’, you’ll see the data displayed in a table, like so:</p>

<div class="clear"></div>

<div class="diagram large">
  <img src="../../diagrams/mlb_script_top10.png" />
</div>
 

<p><strong>&ldquo;But, I&rsquo;d do it a bit differently&rdquo;</strong></p>

<p>Say you want the entries in the “Bats” column to say ‘Switch’ (to signify a switch hitter) instead of ‘B’ (for &ldquo;Both&rdquo; right and left-handed, as it does on baseballreference.com). Here’s how you might copy my script and edit it to include this kind of transformation. This accomplishes item C from our list.</p>

<p>From the Qri webapp&hellip;</p>

<p><strong>Step 1.</strong> Click the ‘add’ button that appears near my dataset when you’re viewing my collection of published datasets. This saves the exact same dataset (body, transform, metadata, structure, viz, and commits ) locally to your node.</p>

<div class="clear"></div>

<div class="diagram large">
  <img src="../../diagrams/mlb_script_add.png" />
</div>

<p><strong>Step 2.</strong> Click on the pencil to go into edit mode.</p>

<p><strong>Step 3.</strong> Click on Transform, so you can begin to edit the script.  In rows 119 and 120 of the image below, I redefine ‘B’ as ‘switch’, and when I run the script, the data comes back just the way I want it.</p>

<p>Here&rsquo;s what that code might look like:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python">    <span class="n">bats</span> <span class="o">=</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">bats</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span><span class="p">:</span>
      <span class="n">bats</span> <span class="o">=</span> <span class="s2">&#34;switch&#34;</span></code></pre></div>
<p>And when you rerun the script, here&rsquo;s what an updated table (body) looks like:</p>

<div class="clear"></div>

<div class="diagram large">
  <img src="../../diagrams/mlb_script_switchb.png" />
</div>

<p><strong>But, what if the source data changed (has updated since I last checked)?</strong></p>

<p>Okay, last cool thing. I can update this dataset at any time by rerunning the script (aka, saving a new version of the data), which retrieves the updated data from baseballreference.com. <em>COMING SOON: clicking a simple ‘Update’ button.</em> This comes in handy if you know that the last time I ran my script was during spring training, and you’re wondering what the rankings look like today.</p>

<p>Here’s how, again, from the webapp:</p>

<ol>
<li><p>From the dataset, click &lsquo;Overview&rsquo;</p></li>

<li><p>Click &lsquo;Edit&rsquo;</p></li>

<li><p>Click &lsquo;Transform&rsquo;</p></li>

<li><p>Click &lsquo;Dry Run&rsquo;, and when everything looks good</p></li>

<li><p>Click &lsquo;Save&rsquo;. Boom. Done!</p></li>
</ol>

<p><strong>Wrapping It Up</strong></p>

<p>Hopefully this post showed you some neat tricks for using qri to save yourself and others a bunch of work (and how to audit that work) - for baseball data, or really any data out in the wild. We’ve set up a <a href="https://github.com/qri-recipes/MLB_Homeruns">github repo</a> to demo how to do all of this from the command line as well, if that&rsquo;s your thing. Give it a look!</p>

<h2 id="the-end"><strong>THE END!</strong></h2>

<hr />

<p><strong>In plain English: &ldquo;Just tell me what your script did to the data.&rdquo;</strong></p>

<p>OK. Here&rsquo;s a breakdown of what my script does to the source data. Please reach out if you have any questions on it (hello@qri.io), or want to adapt it to scrape other data you&rsquo;re interested in.</p>

<ul>
<li><em>I added a Rank value for any rows in which there is no rank value. Those blank rows actually share the same rank as the last listed number.</em></li>
<li><em>I took any cell of a player name, and removed the “+” value and the numbers within parentheses next to any player name (e.g, “(14, 36)”)</em></li>
<li><em>Any player with a “+” next to their name is a hall of famer, so I created a new column, “Hall of Fame (Y/N)” and put a &lsquo;Y&rsquo; in any row corresponding to a player name cell that had a  “+” value, and a &lsquo;N&rsquo; in any row without one</em></li>
<li><em>Eliminated those pesky, redundant header rows.</em></li>
<li><em>I took bolded names (which are active players), created a new column “Active (Y/N)” and placed a &lsquo;Y&rsquo; in any row corresponding to a bolded name, and an &lsquo;N&rsquo; in any row without one.</em></li>
<li><em>Anyone with a bolded name (active player) has two numbers that appear in parentheses next to their name. The first number (for every player in the list) is the number of seasons they’ve played, the second number is their current age (it is only listed if the player is still active). I created two columns for Years in MLB and “Age (if active)”. I moved the first number after each open parenthesis into the “Years in MLB” column, and the second number (if present) into the “Age (if active)” column.</em></li>
</ul>

<p><strong>Here&rsquo;s the full script:</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">load</span><span class="p">(</span><span class="s2">&#34;http.star&#34;</span><span class="p">,</span> <span class="s2">&#34;http&#34;</span><span class="p">)</span>
<span class="n">load</span><span class="p">(</span><span class="s2">&#34;html.star&#34;</span><span class="p">,</span> <span class="s2">&#34;html&#34;</span><span class="p">)</span>

<span class="n">base_url</span> <span class="o">=</span> <span class="s2">&#34;https://www.baseball-reference.com&#34;</span>

<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;https://www.baseball-reference.com/leaders/HR_career.shtml&#34;</span><span class="p">)</span>
  <span class="n">selection</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">())</span>
  <span class="n">table</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;#leader_standard_HR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">()</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">latest_rank</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="nb">len</span><span class="p">()):</span>
    <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">latest_rank</span><span class="p">)</span> <span class="o">=</span> <span class="n">parseRow</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">latest_rank</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
      <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="c1"># [rank, player_name, hof, mlb_seasons, active, age_if_active, player_profile_link, home_runs, bats, hr_log_link</span>
  <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;format&#34;</span><span class="p">:</span><span class="s2">&#34;json&#34;</span><span class="p">,</span>
    <span class="s2">&#34;schema&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;array&#34;</span><span class="p">,</span>
      <span class="s2">&#34;items&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;array&#34;</span><span class="p">,</span>
        <span class="s2">&#34;items&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Rank&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The rank of the player on the all time HR list&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Player Name&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;The player name&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;Hall of Famer&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Y/N if the player is in the Hall of Fame&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;MLB Season&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Number of seasons this player has played&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Active in MLB&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;Y/N if the player is still active in the MLB&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Age If Active&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;If the player is active, the player&#39;s age&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Player Profile Link&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;Link to the player&#39;s profile&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Home Runs&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;Number of homeruns the player has hit&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Bats&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;Which side the hitter bats: R/L/B (both)&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&#34;title&#34;</span><span class="p">:</span><span class="s2">&#34;Home Run Log Link&#34;</span><span class="p">,</span>
            <span class="s2">&#34;description&#34;</span><span class="p">:</span><span class="s2">&#34;Link to the player&#39;s home run log&#34;</span>
          <span class="p">},</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">ds</span><span class="o">.</span><span class="n">set_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">download</span>
  <span class="n">ds</span><span class="o">.</span><span class="n">set_body</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parseRow</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">latest_rank</span><span class="p">):</span>
  <span class="c1"># row has 5 sections</span>
  <span class="n">tds</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">children_filtered</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tds</span><span class="o">.</span><span class="nb">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># rank, player (yrs, age), player profile, home runs, bats, hr log</span>
    <span class="c1"># 1st td -&gt; rank</span>
    <span class="c1"># 2nd td -&gt; player (yrs, age), &lt;a&gt; tag contains player profile link</span>
    <span class="c1"># 3rd td -&gt; home runs</span>
    <span class="c1"># 4th td -&gt; bats</span>
    <span class="c1"># 5th td -&gt; &lt;a&gt; tag contains hr log link</span>
    <span class="c1">#</span>
    <span class="n">rank_string</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">latest_rank</span>
    <span class="n">player</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">hof</span> <span class="o">=</span> <span class="s2">&#34;N&#34;</span>
    <span class="n">mlb_seasons</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">active</span> <span class="o">=</span> <span class="s2">&#34;N&#34;</span>
    <span class="n">age_if_active</span> <span class="o">=</span> <span class="s2">&#34;-&#34;</span>
    <span class="n">player_profile_link</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">home_runs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bats</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="n">hr_log_link</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
    <span class="c1">#</span>
    <span class="c1"># rank</span>
    <span class="c1">#</span>
    <span class="n">rank_string</span> <span class="o">=</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rank_string</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
      <span class="n">rank</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rank_string</span><span class="p">)</span>
      <span class="n">latest_rank</span> <span class="o">=</span> <span class="n">rank</span>
    <span class="c1">#</span>
    <span class="c1"># player name, hall of fame status, mlb seasons, active, age if active</span>
    <span class="c1"># Dave Winchester+ (23, 59)</span>
    <span class="c1">#</span>
    <span class="n">player</span> <span class="o">=</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="n">player_split</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;(&#34;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># player_split = [ &#34;Dave Winchester+ &#34;, &#34;23, 59)&#34; ]</span>
    <span class="c1">#</span>
    <span class="n">name_hof</span> <span class="o">=</span> <span class="n">player_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&#34;+&#34;</span> <span class="ow">in</span> <span class="n">name_hof</span><span class="p">:</span>
      <span class="n">hof</span> <span class="o">=</span> <span class="s2">&#34;Y&#34;</span>
      <span class="n">name_hof</span> <span class="o">=</span> <span class="n">name_hof</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;+&#34;</span><span class="p">)</span>
    <span class="n">player_name</span> <span class="o">=</span> <span class="n">name_hof</span>
    <span class="c1">#</span>
    <span class="c1"># seasons_age_split = [ &#34;23&#34;, &#34; 59&#34; ]</span>
    <span class="c1"># or</span>
    <span class="c1"># seasons_age_split = [ &#34;23&#34; ]</span>
    <span class="c1">#</span>
    <span class="n">seasons_age_split</span> <span class="o">=</span> <span class="n">player_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;)&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">)</span>
    <span class="n">mlb_seasons</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seasons_age_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seasons_age_split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">active</span> <span class="o">=</span> <span class="s2">&#34;Y&#34;</span>
      <span class="n">age_if_active</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seasons_age_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="c1">#</span>
    <span class="n">player_profile_link</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">home_runs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="c1">#</span>
    <span class="n">bats</span> <span class="o">=</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">bats</span> <span class="o">==</span> <span class="s2">&#34;B&#34;</span><span class="p">:</span>
      <span class="n">bats</span> <span class="o">=</span> <span class="s2">&#34;switch&#34;</span>
    <span class="n">hr_log_link</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">tds</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="p">([</span><span class="n">rank</span><span class="p">,</span> <span class="n">player_name</span><span class="p">,</span> <span class="n">hof</span><span class="p">,</span> <span class="n">mlb_seasons</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">age_if_active</span><span class="p">,</span> <span class="n">player_profile_link</span><span class="p">,</span> <span class="n">home_runs</span><span class="p">,</span> <span class="n">bats</span><span class="p">,</span> <span class="n">hr_log_link</span><span class="p">],</span> <span class="n">latest_rank</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">latest_rank</span><span class="p">)</span></code></pre></div>
    </div>
  </section>
</div>
</main>
  <footer>
    <div id="mailing-list-signup">
    <form class="wrap container" action="https://qri.us19.list-manage.com/subscribe/post?u=54a6a8c1171101850b8576277&amp;id=b41eb6f58e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <div id="mc_embed_signup_scroll">
        <h2 class="title">Join our mailing list!</h2>
        <p class="description"><i>At-most-once-a-month updates on project progress.</i></p>

        <input type="email" value="" name="EMAIL" class="required email" placeholder="email@address.com" id="mce-EMAIL">
        
        <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        <div style="position: absolute; left: -5000px;" aria-hidden="true">
          <input type="text" name="b_54a6a8c1171101850b8576277_b41eb6f58e" tabindex="-1" value="">
        </div>
        <div id="mce-responses" class="clear">
          <div class="response" id="mce-error-response" style="display:none"></div>
          <div class="response" id="mce-success-response" style="display:none"></div>
        </div>
      </div>
    </form>
</div>

    <footer id="page_footer">
  <div class="wrap container">
    <div class="row">
        <div class="site_links col-sm-9 mb-5">
          <a href="../../contact/">Contact</a>
          <a href="../../jobs/">Jobs</a>
          <a href="../../faq/">FAQ</a>
          <a href="../../blog/">Blog</a>
          <a href="../../docs/">Docs</a>
          <a href="../../desktop/">Desktop App</a>
        </div>
        <div class="social_links col-sm-3 text-md-right mb-5">
          <a href="https://github.com/qri-io"><i class="fab fa-github fa-lg"></i></a>
          &nbsp;
          <a href="https://twitter.com/qri_io"><i class="fab fa-twitter fa-lg"></i></a>
        </div>
    </div>
    <div class="row">
      <div class="copyright text-center col-12">
        <small>&copy; 2019 qri, inc.</small>
      </div>
    </div>
  </div>
</footer>

</footer>


  <script src="../../js/kube.js" type="text/javascript">
  </script>
  <script src="../../js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="../../js/master.js" type="text/javascript">
  </script>
</body>

</html>
